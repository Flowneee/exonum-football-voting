# Тестовое задание "Голосование за победителя ЧМ по футболу"

## Описание

Реализованная программа представляет собой бэкенд, который позволяет голосовать за победителя чемпионата мира по футболу. Взаимодействие с бэкендом происходит через REST API.

В бэкенде реализовано 2 типа кошельков: кошелек пользователя и кошелек команды. Кошелек команды содержит в себе имя команды, количество отданных за нее голосов и публичный ключ. На этот кошелек могу только "приходить" голоса. Кожелек пользователя же содержит в себе имя пользователяя, его публичный ключ, голосовал ли он, и если да, то хеш этой транзакции. Подразумевается, что пользователь может проголосовать только один раз.


## Возможности

 - регистрация пользователя;
 - регистрация команды;
 - голосование;
 - получение рейтинга команд;
 - получение информации об отдельном пользователе или команды;
 - получение информации о всех пользователях или командах;
 - получение информации о блоке, в котором хранится транзакция голосования пользователя.


## Установка

Достаточно клонировать репозиторий и в выполнить внутри него команду `$ cargo run --example demo`. После чего монжо обращаться к API по адресу **http://localhost:8000**. Для запуска дучше использовать nightly версию Rust.


## Описание API

### Создание кошельков

Для создания кошелька команды или пользователя используется POST запрос по адресу `/api/services/football_voting/v1/create`. Тело запроса (JSON):

    {
	    "body": {
		    "pub_key": "6ce29b2d3ecadc434107ce52c287001c968a1b6eca3e5a1eb62a2419e2924b85",
		    "name": "Alice",
		    "is_team": false
	    },
	    "protocol_version": 0,
	    "service_id": 1,
	    "message_id": 0,
	    "signature": "9f684227f1de663775848b3db656bca685e085391e2b00b0e115679fd45443ef58a5abeb555ab3d5f7a3cd27955a2079e5fd486743f36515c8e5bea07992100b"
    }

Описание полей:

 - pub_key (строка): публичный ключ кошелька;
 - name (строка): имя пользователя или название команды;
 - is_team (булево): если true, то создать кошелек команды, если false, то кошелек пользователя.


В ответе содержится JSON с хешем транзакции:

    {
	    "tx_hash": "35872fba4f3c72d30ef44096484d28401e95c87adcedd2acaa44ce73a200ebbd"
    }


### Голосование

Для голосования используется POST запрос по адресу `/api/services/football_voting/v1/vote`. Тело запроса (JSON):

    {
        "body": {
            "from": "6ce29b2d3ecadc434107ce52c287001c968a1b6eca3e5a1eb62a2419e2924b85",
            "to": "ae6a1c4e84886999dfec7f4d792bf133e7beacf974c000fe45c443727df49df2",
            "seed": "0"
        },
        "protocol_version": 0,
        "service_id": 1,
        "message_id": 1,
        "signature": "2c234680adaa67f1e6573895f1557230ea5373b0972f8aa714611f78931c4bae49680580d41ac806977a7a4f9556781018f1061c9be4adcaabc3760c5a92a70b"
    }


Описние полей:

 - from (строка): публичный ключ кошелька пользователя, который голосует;
 - to (строка): публичный ключ кошелька команды, за готорую голосуют;
 - seed (строка): дополнительное значение (число).


В ответе содержится JSON с хешем транзакции:

    {
    	"tx_hash": "7c5149e43078d52687804fd6f8d2b864afee4db98c2b801d2e6217ba2cf2060b"
    }


### Получение рейтинга команд (списка команд с их голосами)

Для получения рейтинга команд используется GET запрос по адресу `/api/services/football_voting/v1/rating`.

В ответе содержится JSON со списком команд, их названиями, публичными ключами и колиеством голосов. Подразумевается, что больше голосов означает выше рейтинг. Список команд отсортирован по количеству голосов, но должен быть проверен клиентом (на случай, если использованный клиентом парсер JSON не сохраняет порядок значений в списке):

    [
    	{
    		"name": "Wonderland",
    		"pub_key": "ae6a1c4e84886999dfec7f4d792bf133e7beacf974c000fe45c443727df49df2",
    		"votes": "1"
    	},
        {
    		"name": "Underland",
    		"pub_key": "eeeeec4e84886999dfec7f4d792bf133e7beacf974c000fe45c443727df49df2",
    		"votes": "0"
    	},
    ]



### Получение информации об отдельном пользователе

Для получения информации об отдельном пользователе используется GET запрос по адресу `/api/services/football_voting/v1/fan/wallet/{public_key}`.

В ответе содержится JSON, содержащий в себе имя пользователя, его публичный ключ, голосовал ли он, и если да, то хеш транзакции. Если пользователь ещзе не голосовал, то в хеше будет строка из нулей.

    {
        "name": "Alice",
    	"pub_key": "6ce29b2d3ecadc434107ce52c287001c968a1b6eca3e5a1eb62a2419e2924b85",
    	"vote_hash": "0000000000000000000000000000000000000000000000000000000000000000",
    	"voted": false
    }


### Получение информации о пользователях

Для получения информации о всех командах используется GET запрос по адресу `/api/services/football_voting/v1/fan/wallets`.

В ответе содержится JSON, который содержит в себе список описаний пользователей (возвращаемое описание пользователя описано в **Получение информации об отдельном пользователе**).


### Получение информации об отдельной команде

Для получения информации об отдельной команде используется GET запрос по адресу `/api/services/football_voting/v1/team/wallet/{public_key}`.

В ответе содержится JSON, содержащий в себе имя команды, ее публичный ключ и количество голосов:

    {
        "name": "Russia",
        "pub_key": "ae6a1c4e84886999dfec7f4d792bf133e7beacf974c000fe45c443727df49df2",
        "votes": "0"
    }


### Получение информации о командах

Для получения информации о всех командах используется GET запрос по адресу `/api/services/football_voting/v1/team/wallets`.

В ответе содержится JSON, который содержит в себе список описаний команд (возвращаемое описание команды описано в **Получение информации об отдельной команде**).


### Получение информации о блоке, в котором хранится транзакция голосования пользователя

Для получения информации о блоке, в котором хранится транзакция голосования пользователя используется GET запрос по адресу `/api/services/football_voting/v1/block/{public_key}`, в который подставляется публичный ключ пользователя (как его идентификатор).

В ответе содержится JSON, содержащий в себе информацию о блоке.
